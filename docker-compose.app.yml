services:
  api:
    build:
      context: .
      dockerfile: docker/api.Dockerfile
    container_name: dandelion-api
    depends_on:
      minio:
        condition: service_started
    environment:
      # ðŸ‘‰ visible depuis les containers (utilise les noms de services)
      S3_ENDPOINT_URL: http://minio:9000
      S3_ACCESS_KEY: minioadmin
      S3_SECRET_KEY: minioadmin
      S3_MODEL_BUCKET: plant-models
      LOCAL_MODEL_DIR: /models
    ports:
      - "8000:8000"
    volumes:
      - models_cache:/models

  webapp:
    build:
      context: .
      dockerfile: docker/webapp.Dockerfile
    container_name: dandelion-web
    depends_on:
      api:
        condition: service_started
    environment:
      API_URL: http://api:8000/predict
    ports:
      - "8501:8501"

volumes:
  models_cache: